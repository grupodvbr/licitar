<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Documentos ‚Ä¢ LICITAR</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>

:root{
  --azul:#0b1e39;
  --dourado:#c9a86c;
  --bg:#f4f6f9;
  --text:#0f172a;
  --line:#d8dde6;
}

/* TOP STATUS */
#statusBubble{
  position:fixed;
  top:18px;
  right:22px;
  width:18px;
  height:18px;
  border-radius:50%;
  cursor:pointer;
  z-index:9999;
  box-shadow:0 0 12px rgba(0,0,0,.2);
}

/* Caixa de diagn√≥stico */
#diagBox{
  position:fixed;
  top:55px;
  right:22px;
  width:320px;
  background:white;
  padding:18px;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.18);
  display:none;
  z-index:99999;
  font-family:Inter, sans-serif;
}

#diagBox h3{
  margin-top:0;
  font-size:18px;
  color:var(--azul);
}

#diagBox pre{
  background:#f1f1f1;
  padding:10px;
  border-radius:8px;
  overflow:auto;
  max-height:180px;
}

body{
  margin:0;
  padding:28px 35px;
  background:var(--bg);
  font-family:'Inter',sans-serif;
  color:var(--text);
}

.top-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.top-header h1{
  font-size:28px;
  color:var(--azul);
  font-weight:700;
}

/* Bot√µes */
.btn{
  padding:12px 18px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:600;
  color:white;
  margin-right:10px;
}

.btn-nova{ background:var(--azul); }
.btn-upload{ background:var(--dourado); }
.btn-voltar{ background:#9ca3af; }

/* Lista */
#lista{
  margin-top:25px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(230px,1fr));
  gap:22px;
}

.item{
  background:white;
  padding:18px;
  border-radius:16px;
  border:1px solid #e2e2e2;
  cursor:pointer;
  transition:.25s ease;
  box-shadow:0 4px 12px rgba(0,0,0,.05);
}

.thumb{
  width:100%;
  height:140px;
  border-radius:10px;
  object-fit:cover;
  background:#eee;
}

.itemNome{
  margin-top:12px;
  text-align:center;
  font-weight:600;
}

</style>
</head>
<body>

<!-- Status Bubble -->
<div id="statusBubble" style="background:red;" onclick="toggleDiag()"></div>

<!-- Diagnostic Box -->
<div id="diagBox">
  <h3>Diagn√≥stico da Conex√£o</h3>
  <div id="diagStatus"></div>
  <pre id="diagInfo"></pre>
</div>

<!-- HEADER -->
<div class="top-header">
  <h1>Gerenciador de Documentos</h1>
</div>

<!-- Busca -->
<input id="busca" placeholder="Pesquisar..." style="padding:14px;width:100%;border-radius:12px;border:1px solid var(--line);margin-top:15px;">

<!-- Toolbar -->
<div style="margin-top:20px;">
  <button class="btn btn-nova" onclick="abrirPopupCriar()">üìÅ Nova Pasta</button>
  <button class="btn btn-upload" onclick="abrirUpload()">‚¨Ü Upload</button>
  <button class="btn btn-voltar" onclick="voltarPasta()">‚¨Ö Voltar</button>
</div>

<!-- Lista -->
<div id="lista"></div>

<script>

/* =====================================
   SUPABASE CONFIG
===================================== */

const SUPABASE_URL = "https://mblvyircwsaxaslklzky.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_oN2CuBzXHaUF7NHYS_M7aw_tBqVeD-x";

let lastError = null;

let sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ======================================================
   DIAGNOSTIC SYSTEM ‚Äî BOLINHA VERDE / VERMELHA
====================================================== */

async function testConnection(){

  let statusBubble = document.getElementById("statusBubble");
  let diagStatus = document.getElementById("diagStatus");
  let diagInfo = document.getElementById("diagInfo");

  try {
    const { data, error } = await sb.from("documentos").select("*").limit(1);

    if(error){
      lastError = error;
      statusBubble.style.background = "red";
      diagStatus.innerHTML = "<b style='color:red;'>Erro ao conectar ao Supabase</b>";
      diagInfo.innerText = JSON.stringify(error, null, 2);
      return false;
    }

    statusBubble.style.background = "green";
    diagStatus.innerHTML = "<b style='color:green;'>Conectado ao Supabase</b>";

    diagInfo.innerText = JSON.stringify({
      url: SUPABASE_URL,
      bucket: "licitardocs",
      rowsFetched: data?.length || 0
    }, null, 2);

    return true;

  } catch(err){
    lastError = err;
    statusBubble.style.background = "red";
    diagStatus.innerHTML = "<b style='color:red;'>Erro cr√≠tico</b>";
    diagInfo.innerText = err.toString();
    return false;
  }
}

function toggleDiag(){
  let box = document.getElementById("diagBox");
  box.style.display = box.style.display === "block" ? "none" : "block";
}

window.onload = () => {
  testConnection();   // testa assim que abrir
};

</script>

</body>
</html>
