<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cadastros do Sistema • LICITAR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* =====================================================
   PALETA OFICIAL LICITAR
===================================================== */
:root {
  --azul:#0b1e39;
  --azul-claro:#15345c;
  --dourado:#c9a86c;
  --bg:#eef2f7;
  --card:#ffffff;
  --radius:18px;
  --shadow:0 10px 28px rgba(0,0,0,.15);

  --glass:rgba(255,255,255,.78);
  --blur:blur(14px);
}

/* =====================================================
   BASE
===================================================== */
body {
  margin:0;
  padding:25px;
  background:var(--bg);
  font-family:'Inter',sans-serif;
  color:#111;
}

h1 {
  text-align:center;
  color:var(--azul);
  margin-bottom:35px;
  font-size:32px;
  font-weight:700;
  letter-spacing:-0.5px;
}

/* =====================================================
   GRID E CARDS
===================================================== */
.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
  gap:25px;
}

.card {
  background:var(--glass);
  backdrop-filter:var(--blur);
  border-radius:var(--radius);
  padding:22px;
  box-shadow:var(--shadow);
  border:1px solid rgba(255,255,255,.45);
  animation:fadeCard .35s ease;
}

@keyframes fadeCard{
  from{opacity:0; transform:translateY(18px);}
  to{opacity:1; transform:translateY(0);}
}

.card h2 {
  margin-top:0;
  color:var(--azul);
  font-size:22px;
  font-weight:700;
  border-left:4px solid var(--dourado);
  padding-left:10px;
}

/* BOTÃO AÇÃO */
.card button {
  width:100%;
  padding:13px;
  background:var(--dourado);
  color:#000;
  font-size:15px;
  font-weight:700;
  border:none;
  border-radius:12px;
  cursor:pointer;
  transition:.2s;
}
.card button:hover {
  background:#b89554;
  transform:translateY(-1px);
}

/* =====================================================
   TABELAS
===================================================== */
table {
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
  background:white;
  border-radius:14px;
  overflow:hidden;
}

th {
  background:var(--azul);
  color:white;
  padding:12px;
  font-size:14px;
  letter-spacing:.5px;
}

td {
  padding:12px;
  border-bottom:1px solid #eee;
  font-size:14px;
}

tr:hover td {
  background:#f8f9fb;
}

/* BOTÕES AÇÕES */
.btnEditar {
  background:var(--azul);
  color:#fff;
  padding:7px 12px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  margin-right:5px;
  transition:.2s;
}
.btnEditar:hover {
  background:var(--azul-claro);
}

.btnExcluir {
  background:#bb2b2b;
  color:#fff;
  padding:7px 12px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  transition:.2s;
}
.btnExcluir:hover {
  background:#a12222;
}

/* =====================================================
   POPUP
===================================================== */
.overlay {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,.55);
  display:none;
  justify-content:center;
  align-items:center;
  padding:20px;
}

.popup {
  background:white;
  padding:25px;
  width:100%;
  max-width:420px;
  border-radius:20px;
  box-shadow:var(--shadow);
  animation:scale .25s ease;
}

@keyframes scale {
  from{opacity:0; transform:scale(.85);}
  to{opacity:1; transform:scale(1);}
}

.popup h3 {
  margin-top:0;
  color:var(--azul);
  font-size:22px;
  margin-bottom:18px;
}

input,select {
  width:100%;
  padding:12px;
  border:1px solid #ccc;
  border-radius:12px;
  margin-bottom:15px;
  font-size:15px;
}

/* Botões popup */
.btnSalvar {
  width:100%;
  background:var(--azul);
  color:white;
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:16px;
  cursor:pointer;
  transition:.2s;
  margin-bottom:10px;
}
.btnSalvar:hover { background:var(--azul-claro); }

.btnClose {
  width:100%;
  background:#666;
  color:white;
  padding:12px;
  border:none;
  border-radius:12px;
}
.btnClose:hover { background:#555; }
</style>
</head>
<body>

<h1>Painel de Cadastros</h1>

<div class="grid">

  <!-- CONTAS -->
  <div class="card">
    <h2>Contas Bancárias</h2>
    <button onclick="abrirPopup('contas')">Cadastrar Nova Conta</button>

    <table id="tabelaContas">
      <thead>
        <tr>
          <th>Banco</th>
          <th>Agência</th>
          <th>Conta</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- FORNECEDORES -->
  <div class="card">
    <h2>Fornecedores</h2>
    <button onclick="abrirPopup('fornecedores')">Cadastrar Fornecedor</button>

    <table id="tabelaFornec">
      <thead>
        <tr>
          <th>Nome</th>
          <th>CNPJ</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- EMPRESAS -->
  <div class="card">
    <h2>Empresas</h2>
    <button onclick="abrirPopup('empresas')">Cadastrar Empresa</button>

    <table id="tabelaEmpresas">
      <thead>
        <tr>
          <th>Nome</th>
          <th>CNPJ</th>
          <th>UF</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<!-- POPUP -->
<div id="popup" class="overlay">
  <div class="popup" id="popupContent"></div>
</div>


<script>
/* =====================================================
   API 
===================================================== */
const API = "https://script.google.com/macros/s/AKfycbwrYwsj3w2Ik53-aQaLLpcvPtjzGEXqz6pOeAAOXBWDfGHIAhCTSOl0H8WE79_winOQ/exec";

let editando = null;
let editCodigo = null;

/* =====================================================
   FUNÇÕES DE MÁSCARA
===================================================== */
function maskCNPJ(v){
  v = v.replace(/\D/g,"");
  v = v.replace(/^(\d{2})(\d)/,"$1.$2");
  v = v.replace(/^(\d{2})\.(\d{3})(\d)/,"$1.$2.$3");
  v = v.replace(/\.(\d{3})(\d)/,".$1/$2");
  v = v.replace(/(\d{4})(\d)/,"$1-$2");
  return v;
}

function maskPhone(v){
  v = v.replace(/\D/g,"");
  v = v.replace(/^(\d{2})(\d)/,"($1) $2");
  v = v.replace(/(\d{5})(\d)/,"$1-$2");
  return v;
}

function onlyNumbers(v){ return v.replace(/\D/g,""); }

function toUpper(e){ e.value = e.value.toUpperCase(); }

/* =====================================================
   ABRIR POPUP
===================================================== */
function abrirPopup(tipo, dados=null){
  editando = tipo;
  editCodigo = dados ? dados.codigo : null;

  let html = "";

  if(tipo === "contas"){
    html = `
      <h3>${dados ? "Editar Conta" : "Cadastrar Conta Bancária"}</h3>

      <input id="banco" placeholder="Banco" value="${dados?.banco || ""}" oninput="toUpper(this)">

      <input id="agencia" placeholder="Agência" value="${dados?.agencia || ""}"
             oninput="this.value=onlyNumbers(this.value)">

      <input id="conta" placeholder="Conta" value="${dados?.conta || ""}"
             oninput="this.value=onlyNumbers(this.value)">

      <input id="tipo" placeholder="Tipo (CC/CP)" value="${dados?.tipo || ""}" oninput="toUpper(this)">

      <input id="pix" placeholder="Chave PIX" value="${dados?.pix || ""}" oninput="toUpper(this)">

      <button class="btnSalvar" onclick="salvar()">Salvar Registro</button>
      <button class="btnClose" onclick="fecharPopup()">Cancelar</button>
    `;
  }

  if(tipo === "fornecedores"){
    html = `
      <h3>${dados ? "Editar Fornecedor" : "Cadastrar Fornecedor"}</h3>

      <input id="nome" placeholder="Nome" value="${dados?.nome || ""}" oninput="toUpper(this)">

      <input id="cnpj" placeholder="CNPJ" maxlength="18"
             value="${dados?.cnpj || ""}"
             oninput="this.value=maskCNPJ(this.value)">

      <input id="telefone" placeholder="Telefone"
             value="${dados?.telefone || ""}"
             oninput="this.value=maskPhone(this.value)">

      <button class="btnSalvar" onclick="salvar()">Salvar Registro</button>
      <button class="btnClose" onclick="fecharPopup()">Cancelar</button>
    `;
  }

  if(tipo === "empresas"){
    html = `
      <h3>${dados ? "Editar Empresa" : "Cadastrar Empresa"}</h3>

      <input id="nome" placeholder="Nome da Instituição" value="${dados?.nome || ""}" oninput="toUpper(this)">

      <input id="cnpj" placeholder="CNPJ" maxlength="18"
             value="${dados?.cnpj || ""}"
             oninput="this.value=maskCNPJ(this.value)">

      <input id="uf" placeholder="UF" maxlength="2"
             value="${dados?.uf || ""}" 
             oninput="toUpper(this)">

      <button class="btnSalvar" onclick="salvar()">Salvar Registro</button>
      <button class="btnClose" onclick="fecharPopup()">Cancelar</button>
    `;
  }

  document.getElementById("popupContent").innerHTML = html;
  document.getElementById("popup").style.display = "flex";
}

function fecharPopup(){
  document.getElementById("popup").style.display = "none";
}

/* =====================================================
   SALVAR REGISTRO
===================================================== */
async function salvar(){
  let body = {};
  let rota = "";

  if(editando === "contas"){
    body = {
      banco:banco.value.trim(),
      agencia:agencia.value.trim(),
      conta:conta.value.trim(),
      tipo:tipo.value.trim(),
      pix:pix.value.trim()
    };
    rota = editCodigo ? "updateConta" : "addConta";
  }

  if(editando === "fornecedores"){
    body = {
      nome:nome.value.trim(),
      cnpj:cnpj.value.trim(),
      telefone:telefone.value.trim()
    };
    rota = editCodigo ? "updateFornecedor" : "addFornecedor";
  }

  if(editando === "empresas"){
    body = {
      nome:nome.value.trim(),
      cnpj:cnpj.value.trim(),
      uf:uf.value.trim()
    };
    rota = editCodigo ? "updateEmpresa" : "addEmpresa";
  }

  if(editCodigo) body.codigo = editCodigo;

  const url = `${API}?action=${rota}&${new URLSearchParams(body)}`;
  const res = await fetch(url).then(r=>r.json());

  if(res.ok){
    fecharPopup();
    carregarTudo();
  } else {
    alert("Erro ao salvar registro.");
  }
}

/* =====================================================
   EXCLUIR
===================================================== */
async function excluir(tipo, codigo){
  if(!confirm("Deseja realmente excluir?")) return;
  
  const url = `${API}?action=delete${tipo}&codigo=${codigo}`;
  const res = await fetch(url).then(r=>r.json());

  if(res.ok){
    carregarTudo();
  } else {
    alert("Erro ao excluir.");
  }
}

/* =====================================================
   CARREGAR TABELAS
===================================================== */
async function carregarContas(){
  let dados = await fetch(`${API}?action=getContas`).then(r=>r.json());
  let html = "";

  dados.forEach(c=>{
    html += `
      <tr>
        <td>${c.banco}</td>
        <td>${c.agencia}</td>
        <td>${c.conta}</td>
        <td>
          <button class="btnEditar" onclick='abrirPopup("contas", ${JSON.stringify(c)})'>Editar</button>
          <button class="btnExcluir" onclick='excluir("Conta","${c.codigo}")'>Excluir</button>
        </td>
      </tr>`;
  });

  tabelaContas.querySelector("tbody").innerHTML = html;
}

async function carregarFornecedores(){
  let dados = await fetch(`${API}?action=getFornecedores`).then(r=>r.json());
  let html = "";

  dados.forEach(f=>{
    html += `
      <tr>
        <td>${f.nome}</td>
        <td>${f.cnpj}</td>
        <td>
          <button class="btnEditar" onclick='abrirPopup("fornecedores", ${JSON.stringify(f)})'>Editar</button>
          <button class="btnExcluir" onclick='excluir("Fornecedor","${f.codigo}")'>Excluir</button>
        </td>
      </tr>`;
  });

  tabelaFornec.querySelector("tbody").innerHTML = html;
}

async function carregarEmpresas(){
  let dados = await fetch(`${API}?action=getEmpresas`).then(r=>r.json());
  let html = "";

  dados.forEach(emp=>{
    html += `
      <tr>
        <td>${emp.nome}</td>
        <td>${emp.cnpj}</td>
        <td>${emp.uf}</td>
        <td>
          <button class="btnEditar" onclick='abrirPopup("empresas", ${JSON.stringify(emp)})'>Editar</button>
          <button class="btnExcluir" onclick='excluir("Empresa","${emp.codigo}")'>Excluir</button>
        </td>
      </tr>`;
  });

  tabelaEmpresas.querySelector("tbody").innerHTML = html;
}

/* =====================================================
   INICIAR
===================================================== */
function carregarTudo(){
  carregarContas();
  carregarFornecedores();
  carregarEmpresas();
}

window.onload = carregarTudo;
</script>

</body>
</html>
