<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cadastros do Sistema ‚Ä¢ LICITAR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* =====================================================
   PALETA PREMIUM LICITAR
===================================================== */
:root {
  --azul:#0b1e39;
  --azul-claro:#15345c;
  --dourado:#c9a86c;
  --bg:#eef2f7;

  --card-bg:rgba(255,255,255,.65);
  --blur:blur(18px);

  --line:#d7dce3;
  --line-hover:#c7ccd4;

  --shadow:0 10px 28px rgba(0,0,0,.12);
  --radius:22px;
}

/* BASE */
body {
  margin:0;
  padding:25px;
  background:var(--bg);
  font-family:'Inter',sans-serif;
  color:#111;
}

h1 {
  text-align:center;
  color:var(--azul);
  margin-bottom:40px;
  font-size:32px;
  font-weight:800;
}

/* GRID */
.grid {
  display:grid;
  gap:30px;
  grid-template-columns:repeat(auto-fit,minmax(350px,1fr));
}

/* CARD */
.card {
  background:var(--card-bg);
  backdrop-filter:var(--blur);
  border-radius:var(--radius);
  padding:25px;
  box-shadow:var(--shadow);
  border:1px solid rgba(255,255,255,.45);
  display:flex;
  flex-direction:column;
  height:480px; /* üü° ALTURA FIXA */
}

/* T√çTULO */
.card h2 {
  margin:0 0 15px;
  padding-bottom:8px;
  border-bottom:3px solid var(--dourado);
  color:var(--azul);
  font-size:22px;
  font-weight:700;
}

/* BOT√ÉO */
.card button {
  width:100%;
  padding:14px;
  background:var(--dourado);
  border:none;
  border-radius:14px;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  margin-bottom:12px;
  transition:.2s;
}
.card button:hover {
  background:#b89554;
  transform:translateY(-2px);
}

/* CAMPO PESQUISA */
.search {
  width:100%;
  padding:10px 14px;
  border:1px solid #ccc;
  border-radius:12px;
  margin-bottom:12px;
  font-size:15px;
}

/* LISTA COM SCROLL */
.scroll-area {
  flex:1;
  overflow-y:auto;
  padding-right:6px;
}

.scroll-area::-webkit-scrollbar {
  width:6px;
}
.scroll-area::-webkit-scrollbar-thumb {
  background:#ccc;
  border-radius:10px;
}

/* ITENS */
.item {
  padding:10px 5px;
  border-bottom:1px solid var(--line);
  transition:.2s;
}
.item:hover {
  background:#f2f4f7;
}
.item-top {
  display:flex;
  justify-content:space-between;
  font-weight:600;
  color:var(--azul);
}
.item-sub {
  font-size:13px;
  color:#555;
}
.acoes a {
  color:var(--azul);
  margin-left:10px;
  cursor:pointer;
  font-weight:600;
}
.acoes a:hover {
  color:var(--dourado);
}

/* POPUP */
.overlay {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  display:none;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,.5);
}
.popup {
  width:100%;
  max-width:420px;
  background:white;
  border-radius:20px;
  padding:28px;
  box-shadow:var(--shadow);
}

/* INPUTS */
.popup input {
  width:100%;
  padding:14px;
  border:1px solid #ccc;
  border-radius:12px;
  margin-bottom:12px;
  font-size:15px;
}

.btnSalvar {
  width:100%;
  padding:14px;
  background:var(--azul);
  color:white;
  border:none;
  border-radius:12px;
  font-size:16px;
  margin-bottom:10px;
}
.btnSalvar:hover { background:var(--azul-claro); }

.btnClose {
  width:100%;
  padding:12px;
  background:#666;
  color:white;
  border-radius:12px;
  border:none;
}
#loading {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  display:none;
  justify-content:center;
  align-items:center;
  background:rgba(255,255,255,.75);
  font-size:22px;
  font-weight:700;
  color:var(--azul);
}
</style>
</head>
<body>

<h1>Painel de Cadastros</h1>
<div id="loading">Salvando...</div>

<div class="grid">

  <!-- ==============================
       CONTAS BANC√ÅRIAS (SEM PESQUISA)
  =============================== -->
  <div class="card">
    <h2>Contas Banc√°rias</h2>
    <button onclick="abrirPopup('contas')">Cadastrar Nova Conta</button>

    <div class="scroll-area">
      <div id="listaContas"></div>
    </div>
  </div>

  <!-- ==============================
        FORNECEDORES (COM PESQUISA)
  =============================== -->
  <div class="card">
    <h2>Fornecedores</h2>
    <button onclick="abrirPopup('fornecedores')">Cadastrar Fornecedor</button>

    <input type="text" id="buscaFornec" class="search" placeholder="Pesquisar fornecedor..." oninput="filtrar('fornec')">

    <div class="scroll-area">
      <div id="listaFornec"></div>
    </div>
  </div>

  <!-- ==============================
        EMPRESAS (COM PESQUISA)
  =============================== -->
  <div class="card">
    <h2>Empresas</h2>
    <button onclick="abrirPopup('empresas')">Cadastrar Empresa</button>

    <input type="text" id="buscaEmp" class="search" placeholder="Pesquisar empresa..." oninput="filtrar('emp')">

    <div class="scroll-area">
      <div id="listaEmpresas"></div>
    </div>
  </div>

</div>

<!-- POPUP -->
<div id="popup" class="overlay">
  <div class="popup" id="popupContent"></div>
</div>

<script>
/* API */
const API = "https://script.google.com/macros/s/AKfycbxp6oJQfnzxBQO691SynA27BDnWAdFXspvl1bP04rLaZeekTlhuaJngafFDfIjlhizi/exec";

let editando=null;
let editCodigo=null;

/* M√ÅSCARAS */
function maskCNPJ(v){v=v.replace(/\D/g,"");v=v.replace(/^(\d{2})(\d)/,"$1.$2");v=v.replace(/^(\d{2})\.(\d{3})(\d)/,"$1.$2.$3");v=v.replace(/\.(\d{3})(\d)/,".$1/$2");v=v.replace(/(\d{4})(\d)/,"$1-$2");return v;}
function maskPhone(v){v=v.replace(/\D/g,"");v=v.replace(/^(\d{2})(\d)/,"($1) $2");v=v.replace(/(\d{5})(\d)/,"$1-$2");return v;}
function onlyNumbers(v){return v.replace(/\D/g,"");}
function toUpper(e){e.value=e.value.toUpperCase();}

/* POPUP */
function abrirPopup(tipo, dados=null){
  editando=tipo;
  editCodigo=dados?dados.codigo:null;

  let h="";

  if(tipo==="contas"){
    h=`
      <h3>${dados?"Editar Conta":"Cadastrar Conta"}</h3>
      <input id="banco" placeholder="Banco" value="${dados?.banco||""}" oninput="toUpper(this)">
      <input id="agencia" placeholder="Ag√™ncia" value="${dados?.agencia||""}">
      <input id="conta" placeholder="Conta" value="${dados?.conta||""}">
      <input id="tipo" placeholder="Tipo (CC/CP)" value="${dados?.tipo||""}">
      <input id="pix" placeholder="Chave PIX" value="${dados?.pix||""}">
      <button class="btnSalvar" onclick="salvar()">Salvar</button>
      <button class="btnClose" onclick="fecharPopup()">Cancelar</button>
    `;
  }

  if(tipo==="fornecedores"){
    h=`
      <h3>${dados?"Editar Fornecedor":"Cadastrar Fornecedor"}</h3>
      <input id="nome" placeholder="Nome" value="${dados?.nome||""}" oninput="toUpper(this)">
      <input id="cnpj" placeholder="CNPJ" maxlength="18" value="${dados?.cnpj||""}" oninput="this.value=maskCNPJ(this.value)">
      <input id="tel1" placeholder="Whatsapp Principal" maxlength="16" value="${dados?.tel1||""}" oninput="this.value=maskPhone(this.value)">
      <input id="tel2" placeholder="Whatsapp Secund√°rio" maxlength="16" value="${dados?.tel2||""}" oninput="this.value=maskPhone(this.value)">
      <button class="btnSalvar" onclick="salvar()">Salvar</button>
      <button class="btnClose" onclick="fecharPopup()">Cancelar</button>
    `;
  }

  if(tipo==="empresas"){
    h=`
      <h3>${dados?"Editar Empresa":"Cadastrar Empresa"}</h3>
      <input id="nome" placeholder="Nome da Empresa" value="${dados?.nome||""}" oninput="toUpper(this)">
      <input id="cnpj" placeholder="CNPJ" maxlength="18" value="${dados?.cnpj||""}" oninput="this.value=maskCNPJ(this.value)">
      <input id="uf" placeholder="UF" maxlength="2" value="${dados?.uf||""}" oninput="toUpper(this)">
      <button class="btnSalvar" onclick="salvar()">Salvar</button>
      <button class="btnClose" onclick="fecharPopup()">Cancelar</button>
    `;
  }

  popupContent.innerHTML=h;
  popup.style.display="flex";
}
function fecharPopup(){ popup.style.display="none"; }

/* SALVAR */
async function salvar(){
  document.getElementById("loading").style.display="flex";

  let body={}, rota="";

  if(editando==="contas"){
    body={banco:banco.value,agencia:agencia.value,conta:conta.value,tipo:tipo.value,pix:pix.value};
    rota=editCodigo?"updateConta":"addConta";
  }

  if(editando==="fornecedores"){
    body={nome:nome.value,cnpj:cnpj.value,tel1:tel1.value,tel2:tel2.value};
    rota=editCodigo?"updateFornecedor":"addFornecedor";
  }

  if(editando==="empresas"){
    body={nome:nome.value,cnpj:cnpj.value,uf:uf.value};
    rota=editCodigo?"updateEmpresa":"addEmpresa";
  }

  if(editCodigo) body.codigo=editCodigo;

  const url=`${API}?action=${rota}&${new URLSearchParams(body)}`;
  const res=await fetch(url).then(r=>r.json());

  loading.style.display="none";

  if(res.ok){
    fecharPopup();
    carregarTudo();
  } else {
    alert("Erro ao salvar.");
  }
}

/* FILTROS */
function filtrar(tipo){
  let termo="";
  let itens=[];

  if(tipo==="fornec"){
    termo=document.getElementById("buscaFornec").value.toLowerCase();
    itens=document.querySelectorAll("#listaFornec .item");
  }
  if(tipo==="emp"){
    termo=document.getElementById("buscaEmp").value.toLowerCase();
    itens=document.querySelectorAll("#listaEmpresas .item");
  }

  itens.forEach(x=>{
    let texto=x.innerText.toLowerCase();
    x.style.display=texto.includes(termo)?"block":"none";
  });
}

/* LISTAGENS */
async function carregarContas(){
  let d=await fetch(`${API}?action=getContas`).then(r=>r.json());
  let html="";

  d.forEach(x=>{
    html+=`
    <div class="item">
      <div class="item-top">
        <span>üè¶ ${x.banco} ‚Ä¢ Ag ${x.agencia} ‚Ä¢ Conta ${x.conta}</span>
        <span class="acoes">
          <a onclick='abrirPopup("contas",${JSON.stringify(x)})'>Editar</a> |
          <a onclick='excluir("Conta","${x.codigo}")'>Excluir</a>
        </span>
      </div>
      <div class="item-sub">Tipo: ${x.tipo} ‚Ä¢ PIX: ${x.pix||"-"}</div>
    </div>`;
  });

  listaContas.innerHTML=html;
}

async function carregarFornecedores(){
  let d=await fetch(`${API}?action=getFornecedores`).then(r=>r.json());
  let html="";

  d.forEach(x=>{
    html+=`
    <div class="item">
      <div class="item-top">
        <span>üè≠ ${x.nome}</span>
        <span class="acoes">
          <a onclick='abrirPopup("fornecedores",${JSON.stringify(x)})'>Editar</a> |
          <a onclick='excluir("Fornecedor","${x.codigo}")'>Excluir</a>
        </span>
      </div>
      <div class="item-sub">CNPJ: ${x.cnpj} ‚Ä¢ WhatsApp: ${x.tel1}</div>
    </div>`;
  });

  listaFornec.innerHTML=html;
}

async function carregarEmpresas(){
  let d=await fetch(`${API}?action=getEmpresas`).then(r=>r.json());
  let html="";

  d.forEach(x=>{
    html+=`
    <div class="item">
      <div class="item-top">
        <span>üè¢ ${x.nome}</span>
        <span class="acoes">
          <a onclick='abrirPopup("empresas",${JSON.stringify(x)})'>Editar</a> |
          <a onclick='excluir("Empresa","${x.codigo}")'>Excluir</a>
        </span>
      </div>
      <div class="item-sub">CNPJ: ${x.cnpj} ‚Ä¢ UF: ${x.uf}</div>
    </div>`;
  });

  listaEmpresas.innerHTML=html;
}

/* EXCLUIR */
async function excluir(tipo,codigo){
  if(!confirm("Deseja excluir?")) return;
  await fetch(`${API}?action=delete${tipo}&codigo=${codigo}`);
  carregarTudo();
}

/* INICIAR */
function carregarTudo(){
  carregarContas();
  carregarFornecedores();
  carregarEmpresas();
}
window.onload=carregarTudo;

</script>

</body>
</html>
