<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cadastros do Sistema ‚Ä¢ LICITAR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* =====================================================
   PALETA PREMIUM LICITAR
===================================================== */
:root {
  --azul:#0b1e39;
  --azul-claro:#15345c;
  --dourado:#c9a86c;
  --bg:#eef2f7;

  --card-bg:rgba(255,255,255,.65);
  --blur:blur(18px);

  --line:#d7dce3;
  --line-hover:#c7ccd4;

  --shadow:0 10px 28px rgba(0,0,0,.12);
  --radius:22px;
}

/* BASE */
body {
  margin:0;
  padding:25px;
  background:var(--bg);
  font-family:'Inter',sans-serif;
  color:#111;
}

h1 {
  text-align:center;
  color:var(--azul);
  margin-bottom:40px;
  font-size:32px;
  font-weight:800;
}

/* CARD PRINCIPAL */
.card {
  background:var(--card-bg);
  backdrop-filter:var(--blur);
  border-radius:var(--radius);
  padding:25px;
  box-shadow:var(--shadow);
  border:1px solid rgba(255,255,255,.45);
}

/* GRID */
.grid {
  display:grid;
  gap:30px;
  grid-template-columns:repeat(auto-fit,minmax(330px,1fr));
}

/* T√çTULO DO CARD */
.card h2 {
  margin:0 0 18px;
  padding-bottom:10px;
  border-bottom:3px solid var(--dourado);
  color:var(--azul);
  font-size:24px;
  font-weight:700;
}

/* BOT√ÉO PRINCIPAL DO CARD */
.card button {
  width:100%;
  padding:14px;
  background:var(--dourado);
  border:none;
  border-radius:14px;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  margin-bottom:18px;
  transition:.2s;
}
.card button:hover {
  background:#b89554;
  transform:translateY(-2px);
}

/* =====================================================
   LISTA PREMIUM (MODELO 4)
===================================================== */
.lista {
  display:flex;
  flex-direction:column;
}

.item {
  padding:12px 5px;
  display:flex;
  flex-direction:column;
  gap:4px;
  border-bottom:1px solid var(--line);
  transition:.2s;
}
.item:hover {
  background:#f2f4f7;
  border-color:var(--line-hover);
}

.item-top {
  display:flex;
  justify-content:space-between;
  font-size:16px;
  font-weight:600;
  color:var(--azul);
}

.item-sub {
  font-size:13px;
  color:#555;
}

/* BOT√ïES */
.acoes a {
  color:var(--azul);
  cursor:pointer;
  margin-left:10px;
  font-weight:600;
}
.acoes a:hover {
  color:var(--dourado);
}

/* =====================================================
   POPUP
===================================================== */
.overlay {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,.45);
  display:none;
  justify-content:center;
  align-items:center;
}

.popup {
  width:100%;
  max-width:420px;
  background:white;
  border-radius:20px;
  padding:28px;
  box-shadow:var(--shadow);
  animation:fadeScale .25s ease;
}

@keyframes fadeScale {
  from {opacity:0; transform:scale(.85);}
  to {opacity:1; transform:scale(1);}
}

.popup input {
  width:100%;
  padding:14px;
  border:1px solid #ccc;
  border-radius:12px;
  margin-bottom:15px;
  font-size:15px;
}

/* Bot√µes dentro do popup */
.btnSalvar {
  width:100%;
  background:var(--azul);
  color:white;
  font-size:17px;
  padding:14px;
  border:none;
  border-radius:12px;
  margin-bottom:10px;
}
.btnSalvar:hover { background:var(--azul-claro); }

.btnClose {
  width:100%;
  padding:12px;
  background:#666;
  color:#fff;
  border-radius:12px;
  border:none;
}
.btnClose:hover { background:#555; }

/* CAMPO OBRIGAT√ìRIO COM ERRO */
.erro {
  border-color:#d7263d!important;
  animation:shake .2s;
}
@keyframes shake {
  0%{transform:translateX(0);}
  25%{transform:translateX(-4px);}
  50%{transform:translateX(4px);}
  75%{transform:translateX(-4px);}
  100%{transform:translateX(0);}
}

/* =====================================================
   OVERLAY DE SALVANDO
===================================================== */
#loading {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(255,255,255,.75);
  display:none;
  justify-content:center;
  align-items:center;
  font-size:22px;
  color:var(--azul);
  font-weight:700;
  backdrop-filter:blur(4px);
}
</style>
</head>
<body>

<h1>Painel de Cadastros</h1>

<div id="loading">Salvando...</div>

<div class="grid">

  <!-- CONTAS -->
  <div class="card">
    <h2>Contas Banc√°rias</h2>
    <button onclick="abrirPopup('contas')">Cadastrar Nova Conta</button>

    <div class="lista" id="listaContas"></div>
  </div>

  <!-- FORNECEDORES -->
  <div class="card">
    <h2>Fornecedores</h2>
    <button onclick="abrirPopup('fornecedores')">Cadastrar Fornecedor</button>

    <div class="lista" id="listaFornec"></div>
  </div>

  <!-- EMPRESAS -->
  <div class="card">
    <h2>Empresas</h2>
    <button onclick="abrirPopup('empresas')">Cadastrar Empresa</button>

    <div class="lista" id="listaEmpresas"></div>
  </div>

</div>

<!-- POPUP -->
<div id="popup" class="overlay">
  <div class="popup" id="popupContent"></div>
</div>

<script>
/* API */
const API = "https://script.google.com/macros/s/AKfycbxp6oJQfnzxBQO691SynA27BDnWAdFXspvl1bP04rLaZeekTlhuaJngafFDfIjlhizi/exec";

let editando = null;
let editCodigo = null;

/* M√ÅSCARAS */
function maskCNPJ(v){v=v.replace(/\D/g,"");v=v.replace(/^(\d{2})(\d)/,"$1.$2");v=v.replace(/^(\d{2})\.(\d{3})(\d)/,"$1.$2.$3");v=v.replace(/\.(\d{3})(\d)/,".$1/$2");v=v.replace(/(\d{4})(\d)/,"$1-$2");return v;}
function maskPhone(v){v=v.replace(/\D/g,"");v=v.replace(/^(\d{2})(\d)/,"($1) $2");v=v.replace(/(\d{5})(\d)/,"$1-$2");return v;}
function onlyNumbers(v){return v.replace(/\D/g,"");}
function toUpper(e){e.value=e.value.toUpperCase();}

/* ABRIR POPUP */
function abrirPopup(tipo, dados=null){
  editando = tipo;
  editCodigo = dados ? dados.codigo : null;

  let h = "";

  if(tipo==="contas"){
    h = `
    <h3>${dados?"Editar Conta":"Cadastrar Conta Banc√°ria"}</h3>

    <input id="banco" placeholder="Banco" value="${dados?.banco||""}" oninput="toUpper(this)">
    <input id="agencia" placeholder="Ag√™ncia" value="${dados?.agencia||""}" oninput="this.value=onlyNumbers(this.value)">
    <input id="conta" placeholder="Conta" value="${dados?.conta||""}" oninput="this.value=onlyNumbers(this.value)">
    <input id="tipo" placeholder="Tipo (CC/CP)" value="${dados?.tipo||""}" oninput="toUpper(this)">
    <input id="pix" placeholder="Chave PIX" value="${dados?.pix||""}">

    <button class='btnSalvar' onclick="salvar()">Salvar Registro</button>
    <button class='btnClose' onclick="fecharPopup()">Cancelar</button>
    `;
  }

  if(tipo==="fornecedores"){
    h = `
    <h3>${dados?"Editar Fornecedor":"Cadastrar Fornecedor"}</h3>

    <input id="nome" placeholder="Nome" value="${dados?.nome||""}" oninput="toUpper(this)">
    <input id="cnpj" placeholder="CNPJ" maxlength="18" value="${dados?.cnpj||""}" oninput="this.value=maskCNPJ(this.value)">

    <input id="tel1" placeholder="Whatsapp Principal (obrigat√≥rio)" maxlength="16"
           value="${dados?.tel1||""}" oninput="this.value=maskPhone(this.value)">

    <input id="tel2" placeholder="Whatsapp Secund√°rio (opcional)" maxlength="16"
           value="${dados?.tel2||""}" oninput="this.value=maskPhone(this.value)">

    <button class='btnSalvar' onclick="salvar()">Salvar Registro</button>
    <button class='btnClose' onclick="fecharPopup()">Cancelar</button>
    `;
  }

  if(tipo==="empresas"){
    h = `
    <h3>${dados?"Editar Empresa":"Cadastrar Empresa"}</h3>

    <input id="nome" placeholder="Nome da Empresa" value="${dados?.nome||""}" oninput="toUpper(this)">
    <input id="cnpj" placeholder="CNPJ" maxlength="18" value="${dados?.cnpj||""}" oninput="this.value=maskCNPJ(this.value)">
    <input id="uf" placeholder="UF" maxlength="2" value="${dados?.uf||""}" oninput="toUpper(this)">

    <button class='btnSalvar' onclick="salvar()">Salvar Registro</button>
    <button class='btnClose' onclick="fecharPopup()">Cancelar</button>
    `;
  }

  popupContent.innerHTML = h;
  popup.style.display="flex";
}

function fecharPopup(){ popup.style.display="none"; }

/* =====================================================
   SALVAR REGISTRO
===================================================== */
async function salvar(){
  document.getElementById("loading").style.display="flex";

  let body={}, rota="";

  if(editando==="fornecedores"){
    if(!tel1.value.trim()){
      tel1.classList.add("erro");
      document.getElementById("loading").style.display="none";
      return;
    } else {
      tel1.classList.remove("erro");
    }
  }

  if(editando==="contas"){
    body={banco:banco.value.trim(), agencia:agencia.value.trim(), conta:conta.value.trim(), tipo:tipo.value.trim(), pix:pix.value.trim()};
    rota = editCodigo?"updateConta":"addConta";
  }

  if(editando==="fornecedores"){
    body={nome:nome.value.trim(), cnpj:cnpj.value.trim(), tel1:tel1.value.trim(), tel2:tel2.value.trim()};
    rota = editCodigo?"updateFornecedor":"addFornecedor";
  }

  if(editando==="empresas"){
    body={nome:nome.value.trim(), cnpj:cnpj.value.trim(), uf:uf.value.trim()};
    rota = editCodigo?"updateEmpresa":"addEmpresa";
  }

  if(editCodigo) body.codigo = editCodigo;

  const url = `${API}?action=${rota}&${new URLSearchParams(body)}`;
  const res = await fetch(url).then(r=>r.json());

  document.getElementById("loading").style.display="none";

  if(res.ok){
    fecharPopup();
    carregarTudo();
  } else {
    alert("Erro ao salvar.");
  }
}

/* =====================================================
   LISTAGENS
===================================================== */
async function carregarContas(){
  let d = await fetch(`${API}?action=getContas`).then(r=>r.json());
  let h="";

  d.forEach(x=>{
    h += `
      <div class="item">
        <div class="item-top">
          <span>üè¶ ${x.banco} ‚Ä¢ Ag ${x.agencia} ‚Ä¢ Conta ${x.conta}</span>
          <span class="acoes">
            <a onclick='abrirPopup("contas", ${JSON.stringify(x)})'>Editar</a> |
            <a onclick='excluir("Conta","${x.codigo}")'>Excluir</a>
          </span>
        </div>
        <div class="item-sub">Tipo: ${x.tipo} ‚Ä¢ PIX: ${x.pix||"-"}</div>
      </div>`;
  });

  listaContas.innerHTML = h;
}

async function carregarFornecedores(){
  let d = await fetch(`${API}?action=getFornecedores`).then(r=>r.json());
  let h="";

  d.forEach(x=>{
    h += `
      <div class="item">
        <div class="item-top">
          <span>üè≠ ${x.nome}</span>
          <span class="acoes">
            <a onclick='abrirPopup("fornecedores", ${JSON.stringify(x)})'>Editar</a> |
            <a onclick='excluir("Fornecedor","${x.codigo}")'>Excluir</a>
          </span>
        </div>
        <div class="item-sub">CNPJ ‚Ä¢ ${x.cnpj} ‚Ä¢ WhatsApp: ${x.tel1}</div>
      </div>`;
  });

  listaFornec.innerHTML = h;
}

async function carregarEmpresas(){
  let d = await fetch(`${API}?action=getEmpresas`).then(r=>r.json());
  let h="";

  d.forEach(x=>{
    h += `
      <div class="item">
        <div class="item-top">
          <span>üè¢ ${x.nome}</span>
          <span class="acoes">
            <a onclick='abrirPopup("empresas", ${JSON.stringify(x)})'>Editar</a> |
            <a onclick='excluir("Empresa","${x.codigo}")'>Excluir</a>
          </span>
        </div>
        <div class="item-sub">CNPJ ‚Ä¢ ${x.cnpj} ‚Ä¢ UF: ${x.uf}</div>
      </div>`;
  });

  listaEmpresas.innerHTML = h;
}

/* =====================================================
   EXCLUIR
===================================================== */
async function excluir(tipo, codigo){
  if(!confirm("Deseja realmente excluir?")) return;
  await fetch(`${API}?action=delete${tipo}&codigo=${codigo}`);
  carregarTudo();
}

/* =====================================================
   INICIAR
===================================================== */
function carregarTudo(){
  carregarContas();
  carregarFornecedores();
  carregarEmpresas();
}

window.onload = carregarTudo;
</script>

</body>
</html>
