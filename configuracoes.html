<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Configurações • LICITAR</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#eef2f7;
  --card:#ffffff;
  --azul:#0b1e39;
  --muted:#6f7883;
  --radius:18px;
  --shadow:0 8px 25px rgba(0,0,0,.10);
}

/* BASE */
body{
  margin:0;
  padding:40px;
  background:var(--bg);
  font-family:Inter, sans-serif;
  color:var(--azul);
}

h1{
  font-size:34px;
  font-weight:800;
  margin-bottom:28px;
}

/* GRID DE CARDS */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(240px, 1fr));
  gap:20px;
  max-width:1100px;
}

/* CARD */
.card{
  background:white;
  padding:18px;
  border-radius:var(--radius);
  border:1px solid #e3e6ea;
  box-shadow:var(--shadow);
  cursor:pointer;
  transition:.25s;
}
.card:hover{
  transform:translateY(-4px);
  box-shadow:0 10px 25px rgba(0,0,0,.12);
}
.card-title{
  font-size:17px;
  font-weight:700;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,.55);
  z-index:999;
  padding:20px;
}
.modal-box{
  background:white;
  width:100%;
  max-width:480px;
  border-radius:18px;
  padding:25px;
  box-shadow:var(--shadow);
}
.modal h2{
  margin-top:0;
  margin-bottom:18px;
}

/* FORM */
label{
  font-weight:600;
  font-size:14px;
  display:block;
  margin-bottom:4px;
}
input, select{
  width:100%;
  padding:12px;
  border:1px solid #d0d5dd;
  border-radius:12px;
  margin-bottom:14px;
  font-size:14px;
}
button{
  padding:12px 18px;
  border:none;
  border-radius:12px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
}
.btnSalvar{
  background:var(--azul);
  color:white;
  width:100%;
}
.btnFechar{
  background:#ccc;
  width:100%;
  margin-top:8px;
}

</style>
</head>

<body>

<h1>Configurações</h1>

<div class="grid">
  <div class="card" onclick="abrirModal('cadEmpresa')">
    <div class="card-title">Cadastrar Empresa</div>
  </div>

  <div class="card" onclick="listarEmpresas()">
    <div class="card-title">Editar Empresa</div>
  </div>

  <div class="card" onclick="abrirModal('cadLicitacao')">
    <div class="card-title">Cadastrar Licitação</div>
  </div>

  <div class="card" onclick="abrirModal('importExcel')">
    <div class="card-title">Importar Itens Excel</div>
  </div>

  <div class="card" onclick="window.location.href='licitacoes.html'">
    <div class="card-title">Gerenciar Licitações</div>
  </div>
</div>

<!-- MODAL CADASTRAR EMPRESA -->
<div class="modal" id="modal_cadEmpresa">
  <div class="modal-box">
    <h2>Nova Empresa</h2>

    <label>Código</label>
    <input id="empCodigo">

    <label>Nome</label>
    <input id="empNome">

    <label>CNPJ</label>
    <input id="empCnpj">

    <label>UF</label>
    <select id="empUf">
      <option value="">Selecione</option>
      <option>BA</option><option>SP</option><option>RJ</option>
      <option>MG</option><option>GO</option><option>PR</option>
    </select>

    <button class="btnSalvar" onclick="salvarEmpresa()">Salvar</button>
    <button class="btnFechar" onclick="fecharModal()">Cancelar</button>
  </div>
</div>

<!-- MODAL EDITAR EMPRESA -->
<div class="modal" id="modal_editEmpresa">
  <div class="modal-box">
    <h2>Editar Empresa</h2>

    <input id="editCodigo" readonly>
    <input id="editNome">
    <input id="editCnpj">
    <select id="editUf">
      <option>BA</option><option>SP</option><option>RJ</option>
      <option>MG</option><option>GO</option><option>PR</option>
    </select>

    <button class="btnSalvar" onclick="salvarEdicao()">Salvar Alterações</button>
    <button class="btnFechar" onclick="excluirEmpresa()">Excluir Empresa</button>
    <button class="btnFechar" onclick="fecharModal()">Cancelar</button>
  </div>
</div>

<!-- MODAL CAD LICITAÇÃO -->
<div class="modal" id="modal_cadLicitacao">
  <div class="modal-box">
    <h2>Nova Licitação</h2>

    <label>Código</label>
    <input id="licCodigo">

    <label>Instituição</label>
    <input id="licInst">

    <label>Data Sessão</label>
    <input type="datetime-local" id="licData">

    <label>Valor (R$)</label>
    <input id="licValor">

    <label>Critério</label>
    <input id="licCriterio">

    <label>Modo</label>
    <input id="licModo">

    <button class="btnSalvar" onclick="salvarLicitacao()">Salvar</button>
    <button class="btnFechar" onclick="fecharModal()">Cancelar</button>
  </div>
</div>

<!-- MODAL IMPORTAR EXCEL -->
<div class="modal" id="modal_importExcel">
  <div class="modal-box">
    <h2>Importar Itens Excel</h2>

    <input type="file" id="fileExcel" accept=".xlsx,.xls">

    <button class="btnSalvar" onclick="enviarExcel()">Enviar Excel</button>
    <button class="btnFechar" onclick="fecharModal()">Cancelar</button>
  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbwq2C8gFpDRx_gmDrA0rKs0H_ljYp5b5mCt-f2BJR0jkybvGjfz9gQ_BaX-apRwblFo/exec";

function abrirModal(id){
  document.getElementById("modal_" + id).style.display="flex";
}
function fecharModal(){
  document.querySelectorAll(".modal").forEach(m=>m.style.display="none");
}

/* ============= EMPRESA ============= */

async function salvarEmpresa(){
  const payload = {
    action: "addEmpresa",
    codigo: empCodigo.value,
    nome: empNome.value,
    cnpj: empCnpj.value,
    uf: empUf.value
  };

  const r = await fetch(API, {
    method: "POST",
    body: JSON.stringify(payload)
  });

  alert("Empresa cadastrada!");
  fecharModal();
}

/* LISTAR E EDITAR */
let empresas = [];

async function listarEmpresas(){
  const r = await fetch(API + "?action=listEmpresas");
  empresas = await r.json();

  const nome = prompt("Digite o código da empresa que deseja editar:");

  const emp = empresas.find(e => e.codigo === nome);

  if(!emp){ alert("Empresa não encontrada"); return; }

  editCodigo.value = emp.codigo;
  editNome.value = emp.nome;
  editCnpj.value = emp.cnpj;
  editUf.value = emp.uf;

  abrirModal("editEmpresa");
}

async function salvarEdicao(){
  const payload = {
    action: "updateEmpresa",
    codigo: editCodigo.value,
    nome: editNome.value,
    cnpj: editCnpj.value,
    uf: editUf.value
  };

  await fetch(API, {
    method: "POST",
    body: JSON.stringify(payload)
  });

  alert("Empresa atualizada!");
  fecharModal();
}

async function excluirEmpresa(){
  if(!confirm("Tem certeza?")) return;

  await fetch(API, {
    method:"POST",
    body: JSON.stringify({
      action:"deleteEmpresa",
      codigo: editCodigo.value
    })
  });

  alert("Empresa excluída!");
  fecharModal();
}

/* ============= LICITAÇÃO ============= */

async function salvarLicitacao(){
  const dados = {
    action: "addLicitacao",
    codigo: licCodigo.value,
    instituicao: licInst.value,
    dataSessaoISO: licData.value,
    valorBR: licValor.value,
    criterio: licCriterio.value,
    modo: licModo.value
  };

  await fetch(API, {
    method:"POST",
    body: JSON.stringify(dados)
  });

  alert("Licitação cadastrada!");
  fecharModal();
}

/* ============= IMPORTAR EXCEL ============= */

async function enviarExcel(){
  alert("Envio de Excel será configurado junto ao backend GAS.");
}

</script>
</body>
</html>
