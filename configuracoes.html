<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cadastros do Sistema • LICITAR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --azul:#0b1e39;
  --azul-claro:#15345c;
  --dourado:#c9a86c;
  --bg:#eef2f7;
  --card:#ffffff;
  --radius:18px;
  --shadow:0 10px 25px rgba(0,0,0,.12);
}

body {
  margin:0;
  padding:20px;
  background:var(--bg);
  font-family:'Inter',sans-serif;
}

h1 {
  text-align:center;
  color:var(--azul);
  margin-bottom:25px;
}

/* GRID PRINCIPAL */
.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:20px;
}

/* CARDS */
.card {
  background:var(--card);
  border-radius:var(--radius);
  padding:20px;
  box-shadow:var(--shadow);
}

.card h2 {
  margin-top:0;
  color:var(--azul);
  font-size:20px;
}

.card button {
  width:100%;
  padding:12px;
  background:var(--dourado);
  color:#000;
  font-size:15px;
  font-weight:600;
  border:none;
  border-radius:12px;
  cursor:pointer;
}
.card button:hover {
  background:#b89554;
}

/* TABELAS */
table {
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th, td {
  padding:10px;
  border-bottom:1px solid #ddd;
  font-size:14px;
}
th {
  background:var(--azul);
  color:white;
}

/* POPUP */
.overlay {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,.55);
  display:none;
  justify-content:center;
  align-items:center;
  padding:20px;
}

.popup {
  background:white;
  padding:22px;
  width:100%;
  max-width:420px;
  border-radius:18px;
  box-shadow:var(--shadow);
  animation:fade .2s ease;
}

@keyframes fade {
  from {opacity:0; transform:scale(.85);}
  to {opacity:1; transform:scale(1);}
}

.popup h3 {
  margin-top:0;
  color:var(--azul);
  margin-bottom:15px;
}

input,select {
  width:100%;
  padding:12px;
  border:1px solid #ccc;
  border-radius:10px;
  margin-bottom:12px;
}

.btnSalvar {
  width:100%;
  background:var(--azul);
  color:white;
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:16px;
  cursor:pointer;
}
.btnSalvar:hover {
  background:var(--azul-claro);
}

.btnClose {
  margin-top:10px;
  width:100%;
  background:#666;
  color:white;
  padding:12px;
  border:none;
  border-radius:12px;
}

.btnEditar {
  background:#0b1e39;
  color:#fff;
  padding:6px 10px;
  border-radius:8px;
  border:none;
  cursor:pointer;
}
.btnExcluir {
  background:#b13535;
  color:#fff;
  padding:6px 10px;
  border-radius:8px;
  border:none;
  cursor:pointer;
}

</style>
</head>
<body>

<h1>Painel de Cadastros</h1>

<div class="grid">

  <!-- CONTAS BANCÁRIAS -->
  <div class="card">
    <h2>Contas Bancárias</h2>
    <button onclick="abrirPopup('contas')">Cadastrar Nova Conta</button>
    <table id="tabelaContas">
      <thead>
        <tr>
          <th>Banco</th>
          <th>Agência</th>
          <th>Conta</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- FORNECEDORES -->
  <div class="card">
    <h2>Fornecedores</h2>
    <button onclick="abrirPopup('fornecedores')">Cadastrar Fornecedor</button>
    <table id="tabelaFornec">
      <thead>
        <tr>
          <th>Nome</th>
          <th>CNPJ</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- EMPRESAS -->
  <div class="card">
    <h2>Empresas</h2>
    <button onclick="abrirPopup('empresas')">Cadastrar Empresa</button>
    <table id="tabelaEmpresas">
      <thead>
        <tr>
          <th>Nome</th>
          <th>CNPJ</th>
          <th>UF</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<!-- POPUP -->
<div id="popup" class="overlay">
  <div class="popup" id="popupContent"></div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbwrYwsj3w2Ik53-aQaLLpcvPtjzGEXqz6pOeAAOXBWDfGHIAhCTSOl0H8WE79_winOQ/exec";

let editando = null;       // tipo sendo editado
let editCodigo = null;     // id do item sendo editado

/* ======================================
   ABRIR POPUP (NOVO OU EDITAR)
====================================== */
function abrirPopup(tipo, dados=null){

  editando = tipo;
  editCodigo = dados ? dados.codigo : null;

  let html = "";

  if(tipo === "contas"){
    html = `
      <h3>${dados ? "Editar Conta" : "Cadastrar Conta Bancária"}</h3>
      <input id="banco" placeholder="Banco" value="${dados?.banco || ""}">
      <input id="agencia" placeholder="Agência" value="${dados?.agencia || ""}">
      <input id="conta" placeholder="Conta" value="${dados?.conta || ""}">
      <input id="tipo" placeholder="Tipo (CC/CP)" value="${dados?.tipo || ""}">
      <input id="pix" placeholder="Chave PIX" value="${dados?.pix || ""}">
      <button class="btnSalvar" onclick="salvar()">Salvar</button>
      <button class="btnClose" onclick="fecharPopup()">Cancelar</button>
    `;
  }

  if(tipo === "fornecedores"){
    html = `
      <h3>${dados ? "Editar Fornecedor" : "Cadastrar Fornecedor"}</h3>
      <input id="nome" placeholder="Nome" value="${dados?.nome || ""}">
      <input id="cnpj" placeholder="CNPJ" value="${dados?.cnpj || ""}">
      <input id="telefone" placeholder="Telefone" value="${dados?.telefone || ""}">
      <button class="btnSalvar" onclick="salvar()">Salvar</button>
      <button class="btnClose" onclick="fecharPopup()">Cancelar</button>
    `;
  }

  if(tipo === "empresas"){
    html = `
      <h3>${dados ? "Editar Empresa" : "Cadastrar Empresa"}</h3>
      <input id="nome" placeholder="Nome da Instituição" value="${dados?.nome || ""}">
      <input id="cnpj" placeholder="CNPJ" value="${dados?.cnpj || ""}">
      <input id="uf" placeholder="UF" value="${dados?.uf || ""}">
      <button class="btnSalvar" onclick="salvar()">Salvar</button>
      <button class="btnClose" onclick="fecharPopup()">Cancelar</button>
    `;
  }

  document.getElementById("popupContent").innerHTML = html;
  document.getElementById("popup").style.display = "flex";
}

function fecharPopup(){
  document.getElementById("popup").style.display = "none";
}

/* ======================================
   SALVAR (INSERT OU UPDATE)
====================================== */
async function salvar(){
  let body = {};
  let rota = "";

  if(editando === "contas"){
    body = {
      banco: document.getElementById("banco").value,
      agencia: document.getElementById("agencia").value,
      conta: document.getElementById("conta").value,
      tipo: document.getElementById("tipo").value,
      pix: document.getElementById("pix").value
    };
    rota = editCodigo ? "updateConta" : "addConta";
  }

  if(editando === "fornecedores"){
    body = {
      nome: document.getElementById("nome").value,
      cnpj: document.getElementById("cnpj").value,
      telefone: document.getElementById("telefone").value
    };
    rota = editCodigo ? "updateFornecedor" : "addFornecedor";
  }

  if(editando === "empresas"){
    body = {
      nome: document.getElementById("nome").value,
      cnpj: document.getElementById("cnpj").value,
      uf: document.getElementById("uf").value
    };
    rota = editCodigo ? "updateEmpresa" : "addEmpresa";
  }

  if(editCodigo) body.codigo = editCodigo;

  const params = new URLSearchParams(body).toString();
  const url = `${API}?action=${rota}&${params}`;

  const res = await fetch(url).then(r => r.json());

  if(res.ok){
    fecharPopup();
    carregarTudo();
  } else {
    alert("Erro ao salvar cadastro.");
  }
}

/* ======================================
   EXCLUIR
====================================== */
async function excluir(tipo, codigo){

  if(!confirm("Tem certeza que deseja excluir?")) return;

  const url = `${API}?action=delete${tipo}&codigo=${codigo}`;
  const res = await fetch(url).then(r=>r.json());

  if(res.ok){
    carregarTudo();
  } else {
    alert("Erro ao excluir.");
  }
}

/* ======================================
   CARREGAR TUDO
====================================== */
async function carregarContas(){
  let dados = await fetch(`${API}?action=getContas`).then(r=>r.json());
  let html = "";
  dados.forEach(c=>{
    html += `
      <tr>
        <td>${c.banco}</td>
        <td>${c.agencia}</td>
        <td>${c.conta}</td>
        <td>
          <button class="btnEditar" onclick='abrirPopup("contas", ${JSON.stringify(c)})'>Editar</button>
          <button class="btnExcluir" onclick='excluir("Conta","${c.codigo}")'>Excluir</button>
        </td>
      </tr>
    `;
  });
  document.querySelector("#tabelaContas tbody").innerHTML = html;
}

async function carregarFornecedores(){
  let dados = await fetch(`${API}?action=getFornecedores`).then(r=>r.json());
  let html = "";
  dados.forEach(f=>{
    html += `
      <tr>
        <td>${f.nome}</td>
        <td>${f.cnpj}</td>
        <td>
          <button class="btnEditar" onclick='abrirPopup("fornecedores", ${JSON.stringify(f)})'>Editar</button>
          <button class="btnExcluir" onclick='excluir("Fornecedor","${f.codigo}")'>Excluir</button>
        </td>
      </tr>
    `;
  });
  document.querySelector("#tabelaFornec tbody").innerHTML = html;
}

async function carregarEmpresas(){
  let dados = await fetch(`${API}?action=getEmpresas`).then(r=>r.json());
  let html = "";
  dados.forEach(emp=>{
    html += `
      <tr>
        <td>${emp.nome}</td>
        <td>${emp.cnpj}</td>
        <td>${emp.uf}</td>
        <td>
          <button class="btnEditar" onclick='abrirPopup("empresas", ${JSON.stringify(emp)})'>Editar</button>
          <button class="btnExcluir" onclick='excluir("Empresa","${emp.codigo}")'>Excluir</button>
        </td>
      </tr>
    `;
  });
  document.querySelector("#tabelaEmpresas tbody").innerHTML = html;
}

function carregarTudo(){
  carregarContas();
  carregarFornecedores();
  carregarEmpresas();
}

window.onload = carregarTudo;
</script>

</body>
</html>
